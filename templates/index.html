<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能车机系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- ======================================================================= -->
    <!-- ======================= NEW MODERN UI CONTAINER ======================= -->
    <!-- ======================================================================= -->
    <div id="new-interface-container">
        <!-- Top Status Bar -->
        <header class="new-status-bar">
            <div class="status-bar-left">
                <div class="user-avatar">
                    <img src="{{ url_for('static', filename='images/avatar.jpg') }}" alt="User">
                </div>
                <div class="status-item range">
                    <i class="fas fa-battery-full"></i>
                    <span>468km</span>
                </div>
                <div id="gear-display" class="status-item gear">
                    <span id="gear-p" class="active">P</span><span id="gear-r">R</span><span id="gear-n">N</span><span id="gear-d">D</span>
                </div>
                <div id="lights-display" class="status-item lights">
                    <i id="light-high-beam" class="fas fa-sun"></i><i id="light-low-beam" class="fas fa-moon"></i>
                </div>
            </div>
            <div class="status-bar-right">
                <div class="status-item messages"><i class="fas fa-comment-dots"></i></div>
                <div class="status-item bluetooth"><i class="fab fa-bluetooth-b"></i></div>
                <div class="status-item signal"><i class="fas fa-signal"></i></div>
                <div class="status-item weather">
                    <i id="weather-icon" class="fas fa-spinner fa-spin"></i>
                    <span id="weather-display">加载中...</span>
                </div>
                <div class="status-item time-small"><span id="small-time-display">20:36</span></div>
            </div>
        </header>

        <!-- Main Content (Car View) -->
        <main class="new-main-content">
            <div class="main-time-date">
                <h1 id="large-time-display">20:36</h1>
                <p id="large-date-display-line2"></p>
                <p id="large-date-display-line3"></p>
            </div>
            <div class="car-display"></div>
        </main>

        <!-- ======================================================================= -->
        <!-- ================================ DOCK ================================= -->
        <!-- ======================================================================= -->
        <div class="new-dock">
            <div id="driver-temp-control-dock" class="dock-item temp-control driver">
                <i id="driver-temp-down-dock" class="fas fa-chevron-left"></i>
                <span id="driver-temp-display-dock">23.5°</span>
                <i id="driver-temp-up-dock" class="fas fa-chevron-right"></i>
            </div>
            <div class="dock-item app-shortcuts">
                <div id="ac-dock-button" class="app-icon"><i class="fas fa-snowflake"></i></div>
                <div id="settings-dock-button" class="app-icon"><i class="fas fa-cog"></i></div>
                <div id="map-dock-button" class="app-icon"><i class="fas fa-map-marked-alt"></i></div>
                <div class="app-icon"><i class="fas fa-video"></i></div>
                <div id="app-dock-icon" class="app-icon app-drawer-btn"><i class="fas fa-th-large"></i></div>
            </div>
            <div id="media-dock-widget" class="dock-item media-player-widget">
                 <i class="fab fa-spotify" id="dock-media-icon"></i>
                <span id="dock-song-info">无音乐</span>
                <i class="fas fa-step-backward" id="dock-prev-btn"></i>
                <i class="fas fa-pause" id="dock-play-pause-btn"></i>
                <i class="fas fa-step-forward" id="dock-next-btn"></i>
            </div>
            <div id="passenger-temp-control-dock" class="dock-item temp-control passenger">
                <i id="passenger-temp-down-dock" class="fas fa-chevron-left"></i>
                <span id="passenger-temp-display-dock">23.5°</span>
                <i id="passenger-temp-up-dock" class="fas fa-chevron-right"></i>
            </div>
        </div>

        <!-- ======================================================================= -->
        <!-- ======================= MODULES & APP DRAWER (as Overlays) ============ -->
        <!-- ======================================================================= -->
        <div class="module-container">
            <!-- App Drawer -->
            <div id="app-drawer" class="module-container">
                <h2>所有应用</h2>
                <div class="function-card" data-target="status-module">
                    <i class="fas fa-car-battery"></i>
                    <span>车辆状态</span>
                </div>
                <div class="function-card" data-target="ac-module">
                    <i class="fas fa-snowflake"></i>
                    <span>空调控制</span>
                </div>
                <div class="function-card" data-target="media-module">
                    <i class="fas fa-music"></i>
                    <span>多媒体</span>
                </div>
                <div class="function-card" data-target="map-module">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>导航</span>
                </div>
                <!-- This card will now open the new apps module -->
                <div class="function-card" data-target="apps-module">
                    <i class="fas fa-th-large"></i>
                    <span>车载应用</span>
                </div>
                <div class="function-card" data-target="settings-module">
                    <i class="fas fa-cog"></i>
                    <span>设置</span>
                </div>
                <div class="function-card" data-target="fatigue-module">
                    <i class="fas fa-heartbeat"></i>
                    <span>疲劳监测</span>
                </div>
                <button id="collision-detect-btn" class="function-card" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-car-crash"></i>
                    <span>防碰撞检测</span>
                </button>
                <!-- The close button for the app drawer itself -->
                <button class="close-module-btn" style="position: absolute; top: 25px; right: 25px; z-index: 101; background: rgba(20,22,28,0.8); border:none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; backdrop-filter: blur(10px);"><i class="fas fa-times"></i></button>
            </div>

            <!-- AC Control Module (New Design) -->
            <div id="ac-module" class="module">
                <div class="module-header">
                    <h2>空调</h2>
                    <button class="close-module-btn"><i class="fas fa-times"></i></button>
                </div>
                <div class="module-content ac-content">
                    <!-- Driver Zone -->
                    <div class="ac-zone" id="ac-driver-zone">
                        <div class="ac-main-temp-controls">
                            <span class="ac-zone-label">驾驶员</span>
                            <div class="ac-temp-display-wrapper">
                                <span id="ac-driver-temp-display">22.5</span>
                                <span class="ac-temp-unit">°C</span>
                            </div>
                            <div class="ac-controls">
                                <button id="ac-driver-temp-up" class="ac-temp-btn"><i class="fas fa-chevron-up"></i></button>
                                <button id="ac-driver-temp-down" class="ac-temp-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                        </div>
                        <div class="ac-sub-controls">
                            <div class="ac-control-group">
                                <span class="ac-control-label">风量</span>
                                <div class="fan-control">
                                    <button class="sub-ctrl-btn"><i class="fas fa-minus"></i></button>
                                    <div class="fan-level-indicator">
                                        <div class="fan-bar"></div><div class="fan-bar"></div><div class="fan-bar active"></div><div class="fan-bar active"></div><div class="fan-bar active"></div>
                                    </div>
                                    <button class="sub-ctrl-btn"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="ac-control-group">
                                 <span class="ac-control-label">座椅加热</span>
                                 <button class="sub-ctrl-btn seat-heat-btn"><i class="fas fa-fire"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- Middle Shared Controls -->
                    <div class="ac-middle-controls">
                        <button class="middle-ctrl-btn" title="同步温度"><i class="fas fa-link"></i> SYNC</button>
                        <button class="middle-ctrl-btn" title="空调电源"><i class="fas fa-power-off"></i></button>
                        <button class="middle-ctrl-btn" title="自动模式"><i class="fas fa-magic"></i> AUTO</button>
                        <button class="middle-ctrl-btn" title="内外循环"><i class="fas fa-car-side"></i></button>
                        <button class="middle-ctrl-btn" title="前窗除雾"><i class="fas fa-wind"></i></button>
                    </div>

                    <!-- Passenger Zone -->
                    <div class="ac-zone" id="ac-passenger-zone">
                        <div class="ac-main-temp-controls">
                            <span class="ac-zone-label">副驾驶</span>
                            <div class="ac-temp-display-wrapper">
                                <span id="ac-passenger-temp-display">22.5</span>
                                <span class="ac-temp-unit">°C</span>
                            </div>
                            <div class="ac-controls">
                                <button id="ac-passenger-temp-up" class="ac-temp-btn"><i class="fas fa-chevron-up"></i></button>
                                <button id="ac-passenger-temp-down" class="ac-temp-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                        </div>
                         <div class="ac-sub-controls">
                            <div class="ac-control-group">
                                <span class="ac-control-label">风量</span>
                                 <div class="fan-control">
                                    <button class="sub-ctrl-btn"><i class="fas fa-minus"></i></button>
                                    <div class="fan-level-indicator">
                                        <div class="fan-bar"></div><div class="fan-bar"></div><div class="fan-bar active"></div><div class="fan-bar active"></div><div class="fan-bar active"></div>
                                    </div>
                                    <button class="sub-ctrl-btn"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="ac-control-group">
                                 <span class="ac-control-label">座椅加热</span>
                                 <button class="sub-ctrl-btn seat-heat-btn"><i class="fas fa-fire"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Modules (Placeholder Content) -->
            <div class="module" id="vehicle-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>车辆状态</h2><p>内容待添加...</p>
            </div>
            <div class="module" id="navigation-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>导航</h2><p>内容待添加...</p>
            </div>
            <div class="module" id="apps-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>车载应用</h2><p>内容待添加...</p>
            </div>
            <div class="module" id="settings-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>设置</h2><p>内容待添加...</p>
            </div>
        </div>

        <!-- ======================================================================= -->
        <!-- =============================== Map Module ============================== -->
        <!-- ======================================================================= -->
        <div id="map-module" class="module" style="background: transparent; padding: 0;">
            <div id="amap-container" style="width: 100%; height: 100%;"></div>
            
            <!-- Navigation UI -->
            <div class="map-ui-container">
                <div class="map-search-bar">
                    <input type="text" id="map-search-input" placeholder="您想去哪里？">
                    <button id="map-search-button"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div id="map-panel"></div>

            <!-- This button re-uses the existing close logic but is styled to sit on top of the map -->
            <button class="close-module-btn" style="position: absolute; top: 25px; right: 25px; z-index: 101; background: rgba(20,22,28,0.8); border:none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; backdrop-filter: blur(10px);"><i class="fas fa-times"></i></button>
        </div>

        <!-- ======================================================================= -->
        <!-- =========================== Media Player Module ========================= -->
        <!-- ======================================================================= -->
        <div id="media-module" class="module">
             <div class="module-header">
                <h2>音乐播放器</h2>
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="module-content media-player-content">
                <!-- 主要播放区域 -->
                <div class="player-main-section">
                    <!-- 专辑封面 -->
                    <div class="album-art-container">
                        <div class="album-art">
                            <img src="{{ url_for('static', filename='images/car_menu.jpg') }}" alt="专辑封面" id="current-album-art">
                            <div class="album-art-overlay">
                                <i class="fas fa-music"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 歌曲信息 -->
                    <div class="song-info">
                        <h3 id="current-song-title">夜曲</h3>
                        <p id="current-song-artist">周杰伦</p>
                        <p id="current-song-album">十一月的萧邦</p>
                    </div>
                    
                    <!-- 播放进度 -->
                    <div class="progress-section">
                        <div class="time-display">
                            <span id="current-time">0:00</span>
                            <span id="total-time">3:45</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                                <div class="progress-handle" id="progress-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 播放控制 -->
                    <div class="playback-controls">
                        <button class="control-btn" id="shuffle-btn" title="随机播放">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="prev-btn" title="上一首">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-pause-btn" id="play-pause-btn" title="播放/暂停">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="next-btn" title="下一首">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button class="control-btn" id="repeat-btn" title="循环播放">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <!-- 音量控制 -->
                    <div class="volume-section">
                        <i class="fas fa-volume-down"></i>
                        <div class="volume-bar-container">
                            <div class="volume-bar" id="volume-bar">
                                <div class="volume-fill" id="volume-fill"></div>
                                <div class="volume-handle" id="volume-handle"></div>
                            </div>
                        </div>
                        <i class="fas fa-volume-up"></i>
                    </div>
                </div>
                
                <!-- 播放列表区域 -->
                <div class="playlist-section">
                    <div class="playlist-header">
                        <h4>播放列表</h4>
                        <button class="playlist-btn" id="add-song-btn" title="添加歌曲">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="playlist-container">
                        <div class="playlist-item active" data-song-id="1">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">夜曲</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:45</span>
                        </div>
                        <div class="playlist-item" data-song-id="2">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">稻香</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:42</span>
                        </div>
                        <div class="playlist-item" data-song-id="3">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">青花瓷</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:59</span>
                        </div>
                        <div class="playlist-item" data-song-id="4">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">晴天</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">4:29</span>
                        </div>
                        <div class="playlist-item" data-song-id="5">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">七里香</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">5:04</span>
                        </div>
                    </div>
                </div>

                <!-- 歌词显示区域 -->
                <div class="lyrics-section">
                    <div class="lyrics-container" id="lyrics-container">
                        <p class="lyrics-line">歌词加载中...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Status Module -->
        <div id="status-module" class="module">
            <div class="module-header">
                <h2>车辆状态</h2>
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="module-content">
                <p>内容待添加...</p>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ============================== Settings Module ============================ -->
    <!-- ======================================================================= -->
    <div id="settings-module" class="module">
        <div class="module-header">
            <h2>设置</h2>
            <button class="close-module-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="module-content">
            <div class="settings-grid">
                <button class="setting-btn"><i class="fas fa-desktop"></i><span>显示</span></button>
                <button class="setting-btn"><i class="fas fa-volume-up"></i><span>声音</span></button>
                <button class="setting-btn"><i class="fas fa-wifi"></i><span>连接</span></button>
                <button class="setting-btn"><i class="fas fa-car"></i><span>车辆</span></button>
                <button class="setting-btn"><i class="fas fa-user-cog"></i><span>个人资料</span></button>
                <button class="setting-btn"><i class="fas fa-bell"></i><span>通知</span></button>
                <button class="setting-btn"><i class="fas fa-shield-alt"></i><span>安全</span></button>
                <button class="setting-btn"><i class="fas fa-info-circle"></i><span>关于</span></button>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ============================= Apps Module (NEW) ========================= -->
    <!-- ======================================================================= -->
    <div id="apps-module" class="module">
        <div class="module-header">
            <h2>车载应用</h2>
            <button class="close-module-btn" data-target="app-drawer"><i class="fas fa-arrow-left"></i></button>
        </div>
        <div class="module-content">
            <div class="apps-grid">
                <!-- Future apps will go here -->
                <p style="color: #6e7681;">更多应用正在开发中...</p>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ========================= Fatigue Monitor Module (NEW) ================ -->
    <!-- ======================================================================= -->
    <div id="fatigue-module" class="module">
        <div class="module-header">
            <h2>疲劳监测</h2>
            <button class="close-module-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="module-content" style="justify-content: center; align-items: center; text-align: center; color: #6e7681;">
            <i class="fas fa-bed" style="font-size: 8rem; margin-bottom: 20px;"></i>
            <h3>疲劳监测功能正在开发中</h3>
        </div>
    </div>

    </div>

    <!-- Amap JS API Loader -->
    <script type="text/javascript" src="https://webapi.amap.com/loader.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- Main App Logic -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
</body>
</html>