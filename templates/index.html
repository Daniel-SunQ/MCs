<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能车机系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 添加Socket.IO客户端库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- ======================================================================= -->
    <!-- ======================= NEW MODERN UI CONTAINER ======================= -->
    <!-- ======================================================================= -->
    <div id="new-interface-container">
        <!-- Top Status Bar -->
        <header class="new-status-bar">
            <div class="status-bar-left">
                <div class="user-avatar" onclick="window.location.href='/user_center'">
                    <img src="{{ user.avatar if user else url_for('static', filename='images/avatar.jpg') }}" alt="User">
                    <div class="user-info">
                        <span class="username">{{ user.username if user else '未登录' }}</span>
                    </div>
                </div>
                <div class="status-item range">
                    <i class="fas fa-battery-full"></i>
                    <span>468km</span>
                </div>
                <div id="gear-display" class="status-item gear">
                    <span id="gear-p" class="active">P</span><span id="gear-r">R</span><span id="gear-n">N</span><span id="gear-d">D</span>
                </div>
                <div id="lights-display" class="status-item lights">
                    <i id="light-left-turn" class="fas fa-arrow-left"></i>
                    <i id="light-high-beam" class="fas fa-sun"></i>
                    <i id="light-low-beam" class="fas fa-moon"></i>
                    <i id="light-right-turn" class="fas fa-arrow-right"></i>
                </div>
            </div>
            <div class="status-bar-right">
                <div class="status-item messages"><i class="fas fa-comment-dots"></i></div>
                <div class="status-item bluetooth"><i class="fab fa-bluetooth-b"></i></div>
                <div class="status-item signal"><i class="fas fa-signal"></i></div>
                <div class="status-item weather">
                    <i id="weather-icon" class="fas fa-spinner fa-spin"></i>
                    <span id="weather-display">加载中...</span>
                </div>
                <div class="status-item time-small"><span id="small-time-display">20:36</span></div>
            </div>
        </header>

        <!-- Main Content (Car View) -->
        <main class="new-main-content">
            <div class="main-time-date">
                <h1 id="large-time-display">20:36</h1>
                <p id="large-date-display-line2"></p>
                <p id="large-date-display-line3"></p>
            </div>
            <div class="car-display"></div>
        </main>

        <!-- ======================================================================= -->
        <!-- ================================ DOCK ================================= -->
        <!-- ======================================================================= -->
        <div class="new-dock">
            <div id="driver-temp-control-dock" class="dock-item temp-control driver">
                <i id="driver-temp-down-dock" class="fas fa-chevron-left"></i>
                <span id="driver-temp-display-dock">23.5°</span>
                <i id="driver-temp-up-dock" class="fas fa-chevron-right"></i>
            </div>
            <div class="dock-item app-shortcuts">
                <div id="ac-dock-button" class="app-icon"><i class="fas fa-snowflake"></i></div>
                <div id="settings-dock-button" class="app-icon"><i class="fas fa-cog"></i></div>
                <div id="map-dock-button" class="app-icon"><i class="fas fa-map-marked-alt"></i></div>
                <div class="app-icon"><i class="fas fa-video"></i></div>
                <div id="app-dock-icon" class="app-icon app-drawer-btn"><i class="fas fa-th-large"></i></div>
            </div>
            <div id="media-dock-widget" class="dock-item media-player-widget">
                 <i class="fab fa-spotify" id="dock-media-icon"></i>
                <span id="dock-song-info">无音乐</span>
                <i class="fas fa-step-backward" id="dock-prev-btn"></i>
                <i class="fas fa-pause" id="dock-play-pause-btn"></i>
                <i class="fas fa-step-forward" id="dock-next-btn"></i>
            </div>
            <div id="passenger-temp-control-dock" class="dock-item temp-control passenger">
                <i id="passenger-temp-down-dock" class="fas fa-chevron-left"></i>
                <span id="passenger-temp-display-dock">23.5°</span>
                <i id="passenger-temp-up-dock" class="fas fa-chevron-right"></i>
            </div>
        </div>

        <!-- ======================================================================= -->
        <!-- ======================= MODULES & APP DRAWER (as Overlays) ============ -->
        <!-- ======================================================================= -->
        <div class="module-container">
            <!-- App Drawer -->
            <div id="app-drawer" class="module-container">
                <h2>所有应用</h2>
                <div class="function-card" data-target="status-module">
                    <i class="fas fa-car-battery"></i>
                    <span>车辆状态</span>
                </div>
                <div class="function-card" data-target="ac-module">
                    <i class="fas fa-snowflake"></i>
                    <span>空调控制</span>
                </div>
                <div class="function-card" data-target="media-module">
                    <i class="fas fa-music"></i>
                    <span>多媒体</span>
                </div>
                <div class="function-card" data-target="map-module">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>导航</span>
                </div>
                <!-- This card will now open the new apps module -->
                <div class="function-card" data-target="apps-module">
                    <i class="fas fa-th-large"></i>
                    <span>车载应用</span>
                </div>
                <div class="function-card" data-target="settings-module">
                    <i class="fas fa-cog"></i>
                    <span>设置</span>
                </div>
                <div class="function-card" data-target="fatigue-module">
                    <i class="fas fa-heartbeat"></i>
                    <span>疲劳监测</span>
                </div>
                <button id="collision-detect-btn" class="function-card" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-car-crash"></i>
                    <span>防碰撞检测</span>
                </button>
                <!-- The close button for the app drawer itself -->
                <button class="close-module-btn" style="position: absolute; top: 25px; right: 25px; z-index: 101; background: rgba(20,22,28,0.8); border:none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; backdrop-filter: blur(10px);"><i class="fas fa-times"></i></button>
            </div>

            <!-- AC Control Module (New Design) -->
            <div id="ac-module" class="module">
                <div class="module-header">
                    <h2>空调</h2>
                    <button class="close-module-btn"><i class="fas fa-times"></i></button>
                </div>
                <div class="module-content ac-content">
                    <!-- Driver Zone -->
                    <div class="ac-zone" id="ac-driver-zone">
                        <div class="ac-main-temp-controls">
                            <span class="ac-zone-label">驾驶员</span>
                            <div class="ac-temp-display-wrapper">
                                <span id="ac-driver-temp-display">22.5</span>
                                <span class="ac-temp-unit">°C</span>
                            </div>
                            <div class="ac-controls">
                                <button id="ac-driver-temp-up" class="ac-temp-btn"><i class="fas fa-chevron-up"></i></button>
                                <button id="ac-driver-temp-down" class="ac-temp-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                        </div>
                        <div class="ac-sub-controls">
                            <div class="ac-control-group">
                                <span class="ac-control-label">风量</span>
                                <div class="fan-control">
                                    <button class="sub-ctrl-btn"><i class="fas fa-minus"></i></button>
                                    <div class="fan-level-indicator">
                                        <div class="fan-bar"></div><div class="fan-bar"></div><div class="fan-bar active"></div><div class="fan-bar active"></div><div class="fan-bar active"></div>
                                    </div>
                                    <button class="sub-ctrl-btn"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="ac-control-group">
                                 <span class="ac-control-label">座椅加热</span>
                                 <button class="sub-ctrl-btn seat-heat-btn"><i class="fas fa-fire"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- Middle Shared Controls -->
                    <div class="ac-middle-controls">
                        <button class="middle-ctrl-btn" title="同步温度"><i class="fas fa-link"></i> SYNC</button>
                        <button class="middle-ctrl-btn" title="空调电源"><i class="fas fa-power-off"></i></button>
                        <button class="middle-ctrl-btn" title="自动模式"><i class="fas fa-magic"></i> AUTO</button>
                        <button class="middle-ctrl-btn" title="内外循环"><i class="fas fa-car-side"></i></button>
                        <button class="middle-ctrl-btn" title="前窗除雾"><i class="fas fa-wind"></i></button>
                    </div>

                    <!-- Passenger Zone -->
                    <div class="ac-zone" id="ac-passenger-zone">
                        <div class="ac-main-temp-controls">
                            <span class="ac-zone-label">副驾驶</span>
                            <div class="ac-temp-display-wrapper">
                                <span id="ac-passenger-temp-display">22.5</span>
                                <span class="ac-temp-unit">°C</span>
                            </div>
                            <div class="ac-controls">
                                <button id="ac-passenger-temp-up" class="ac-temp-btn"><i class="fas fa-chevron-up"></i></button>
                                <button id="ac-passenger-temp-down" class="ac-temp-btn"><i class="fas fa-chevron-down"></i></button>
                            </div>
                        </div>
                         <div class="ac-sub-controls">
                            <div class="ac-control-group">
                                <span class="ac-control-label">风量</span>
                                 <div class="fan-control">
                                    <button class="sub-ctrl-btn"><i class="fas fa-minus"></i></button>
                                    <div class="fan-level-indicator">
                                        <div class="fan-bar"></div><div class="fan-bar"></div><div class="fan-bar active"></div><div class="fan-bar active"></div><div class="fan-bar active"></div>
                                    </div>
                                    <button class="sub-ctrl-btn"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="ac-control-group">
                                 <span class="ac-control-label">座椅加热</span>
                                 <button class="sub-ctrl-btn seat-heat-btn"><i class="fas fa-fire"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Modules (Placeholder Content) -->
            <div class="module" id="vehicle-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>车辆状态</h2><p>内容待添加...</p>
            </div>
            <div class="module" id="navigation-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>导航</h2><p>内容待添加...</p>
            </div>
            <div class="module" id="apps-module" style="display: none;">
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
                <h2>车载应用</h2><p>内容待添加...</p>
            </div>

            <!-- 在 module-container 中添加新模块 -->
            <div id="gear-lights-module" class="module">
                <div class="module-header">
                    <h2>档位与灯光控制</h2>
                    <button class="close-module-btn"><i class="fas fa-times"></i></button>
                </div>
                <div class="module-content gear-lights-content">
                    <!-- 档位控制 -->
                    <div class="control-section gear-section">
                        <h3>档位控制</h3>
                        <div class="gear-controls">
                            <button class="gear-btn" data-gear="P">P</button>
                            <button class="gear-btn" data-gear="R">R</button>
                            <button class="gear-btn" data-gear="N">N</button>
                            <button class="gear-btn" data-gear="D">D</button>
                        </div>
                        <div class="gear-info">
                            <p>当前档位：<span id="current-gear">P</span></p>
                        </div>
                    </div>
                    
                    <!-- 灯光控制 -->
                    <div class="control-section lights-section">
                        <h3>灯光控制</h3>
                        <div class="lights-controls">
                            <button class="light-btn" data-light="off">
                                <i class="fas fa-lightbulb"></i>
                                <span>关闭</span>
                            </button>
                            <button class="light-btn" data-light="left-turn">
                                <i class="fas fa-arrow-left"></i>
                                <span>左转向</span>
                            </button>
                            <button class="light-btn" data-light="right-turn">
                                <i class="fas fa-arrow-right"></i>
                                <span>右转向</span>
                            </button>
                            <button class="light-btn" data-light="position">
                                <i class="fas fa-parking"></i>
                                <span>位置灯</span>
                            </button>
                            <button class="light-btn" data-light="low">
                                <i class="fas fa-moon"></i>
                                <span>近光灯</span>
                            </button>
                            <button class="light-btn" data-light="high">
                                <i class="fas fa-sun"></i>
                                <span>远光灯</span>
                            </button>
                            <button class="light-btn" data-light="fog">
                                <i class="fas fa-smog"></i>
                                <span>雾灯</span>
                            </button>
                            <button class="light-btn" data-light="emergency">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>警示灯</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================================================================= -->
        <!-- =============================== Map Module ============================== -->
        <!-- ======================================================================= -->
        <div id="map-module" class="module" style="background: transparent; padding: 0;">
            <div id="amap-container" style="width: 100%; height: 100%;"></div>
            
            <!-- Navigation UI -->
            <div class="map-ui-container">
                <div class="map-search-bar">
                    <input type="text" id="map-search-input" placeholder="您想去哪里？">
                    <button id="map-search-button"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div id="map-panel"></div>

            <!-- This button re-uses the existing close logic but is styled to sit on top of the map -->
            <button class="close-module-btn" style="position: absolute; top: 25px; right: 25px; z-index: 101; background: rgba(20,22,28,0.8); border:none; color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; backdrop-filter: blur(10px);"><i class="fas fa-times"></i></button>
        </div>

        <!-- ======================================================================= -->
        <!-- =========================== Media Player Module ========================= -->
        <!-- ======================================================================= -->
        <div id="media-module" class="module">
             <div class="module-header">
                <h2>音乐播放器</h2>
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="module-content media-player-content">
                <!-- 主要播放区域 -->
                <div class="player-main-section">
                    <!-- 专辑封面 -->
                    <div class="album-art-container">
                        <div class="album-art">
                            <img src="{{ url_for('static', filename='images/car_menu.jpg') }}" alt="专辑封面" id="current-album-art">
                            <div class="album-art-overlay">
                                <i class="fas fa-music"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 歌曲信息 -->
                    <div class="song-info">
                        <h3 id="current-song-title">夜曲</h3>
                        <p id="current-song-artist">周杰伦</p>
                        <p id="current-song-album">十一月的萧邦</p>
                    </div>
                    
                    <!-- 播放进度 -->
                    <div class="progress-section">
                        <div class="time-display">
                            <span id="current-time">0:00</span>
                            <span id="total-time">3:45</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                                <div class="progress-handle" id="progress-handle"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 播放控制 -->
                    <div class="playback-controls">
                        <button class="control-btn" id="shuffle-btn" title="随机播放">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="prev-btn" title="上一首">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-pause-btn" id="play-pause-btn" title="播放/暂停">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn" id="next-btn" title="下一首">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button class="control-btn" id="repeat-btn" title="循环播放">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <!-- 音量控制 -->
                    <div class="volume-section">
                        <i class="fas fa-volume-down"></i>
                        <div class="volume-bar-container">
                            <div class="volume-bar" id="volume-bar">
                                <div class="volume-fill" id="volume-fill"></div>
                                <div class="volume-handle" id="volume-handle"></div>
                            </div>
                        </div>
                        <i class="fas fa-volume-up"></i>
                    </div>
                </div>
                
                <!-- 播放列表区域 -->
                <div class="playlist-section">
                    <div class="playlist-header">
                        <h4>播放列表</h4>
                        <button class="playlist-btn" id="add-song-btn" title="添加歌曲">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="playlist-container">
                        <div class="playlist-item active" data-song-id="1">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">夜曲</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:45</span>
                        </div>
                        <div class="playlist-item" data-song-id="2">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">稻香</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:42</span>
                        </div>
                        <div class="playlist-item" data-song-id="3">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">青花瓷</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">3:59</span>
                        </div>
                        <div class="playlist-item" data-song-id="4">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">晴天</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">4:29</span>
                        </div>
                        <div class="playlist-item" data-song-id="5">
                            <div class="playlist-item-info">
                                <span class="playlist-song-title">七里香</span>
                                <span class="playlist-song-artist">周杰伦</span>
                            </div>
                            <span class="playlist-song-duration">5:04</span>
                        </div>
                    </div>
                </div>

                <!-- 歌词显示区域 -->
                <div class="lyrics-section">
                    <div class="lyrics-container" id="lyrics-container">
                        <p class="lyrics-line">歌词加载中...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Status Module -->
        <div id="status-module" class="module">
            <div class="module-header">
                <h2>车辆状态</h2>
                <button class="close-module-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="module-content">
                <p>内容待添加...</p>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ============================== Settings Module ============================ -->
    <!-- ======================================================================= -->
    <div id="settings-module" class="module">
        <div class="module-header">
            <h2>个性化设置</h2>
            <button class="close-module-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="module-content settings-content">
            <!-- 设置导航 -->
            <div class="settings-nav">
                <div class="settings-nav-item active" data-target="profile-settings">
                    <i class="fas fa-user-cog"></i>
                    <span>个人资料</span>
                </div>
                <div class="settings-nav-item" data-target="vehicle-settings">
                    <i class="fas fa-car"></i>
                    <span>车辆设置</span>
                </div>
                <div class="settings-nav-item" data-target="notification-settings">
                    <i class="fas fa-bell"></i>
                    <span>通知设置</span>
                </div>
                <div class="settings-nav-item" data-target="privacy-settings">
                    <i class="fas fa-shield-alt"></i>
                    <span>隐私安全</span>
                </div>
                <div class="settings-nav-item" data-target="system-settings">
                    <i class="fas fa-cog"></i>
                    <span>系统设置</span>
                </div>
                <div class="settings-nav-item" data-target="about-settings">
                    <i class="fas fa-info-circle"></i>
                    <span>关于系统</span>
                </div>
            </div>

            <!-- 设置内容区域 -->
            <div class="settings-panels">
                <!-- 个人资料设置 -->
                <div id="profile-settings" class="settings-panel active">
                    <h3>个人资料</h3>
                    <form id="profile-form-settings">
                        <div class="form-group">
                            <label>用户名</label>
                            <input type="text" id="profile-username-settings" value="{{ user.username if user else '' }}">
                        </div>
                        <div class="form-group">
                            <label>邮箱</label>
                            <input type="email" id="profile-email-settings" value="{{ user.email if user else '' }}">
                        </div>
                        <div class="form-group">
                            <label>手机号</label>
                            <input type="tel" id="profile-phone-settings" value="{{ user.phone if user else '' }}">
                        </div>
                        <div class="form-group">
                            <label>个人简介</label>
                            <textarea rows="3" id="profile-bio-settings">{{ user.bio if user else '' }}</textarea>
                        </div>
                        <button type="submit" class="btn-primary">保存修改</button>
                    </form>
                </div>

                <!-- 车辆设置 -->
                <div id="vehicle-settings" class="settings-panel">
                    <h3>车辆设置</h3>
                    
                    <!-- 座椅设置 -->
                    <div class="settings-section">
                        <h4><i class="fas fa-chair"></i> 座椅设置</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶座椅位置</div>
                                    <div class="setting-description">调整驾驶座椅位置</div>
                                </div>
                                <select id="driver-seat-position" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="comfort">舒适</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶座椅高度</div>
                                    <div class="setting-description">调整座椅高度</div>
                                </div>
                                <div class="slider-container">
                                    <input type="range" id="driver-seat-height" min="0" max="100" value="50">
                                    <span id="driver-seat-height-value">50%</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶座椅倾斜</div>
                                    <div class="setting-description">调整座椅倾斜角度</div>
                                </div>
                                <div class="slider-container">
                                    <input type="range" id="driver-seat-recline" min="0" max="100" value="30">
                                    <span id="driver-seat-recline-value">30%</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶座椅腰部支撑</div>
                                    <div class="setting-description">调整腰部支撑强度</div>
                                </div>
                                <div class="slider-container">
                                    <input type="range" id="driver-seat-lumbar" min="0" max="100" value="50">
                                    <span id="driver-seat-lumbar-value">50%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 方向盘设置 -->
                    <div class="settings-section">
                        <h4><i class="fas fa-steering-wheel"></i> 方向盘设置</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">方向盘位置</div>
                                    <div class="setting-description">调整方向盘位置</div>
                                </div>
                                <select id="steering-wheel-position" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="comfort">舒适</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">方向盘高度</div>
                                    <div class="setting-description">调整方向盘高度</div>
                                </div>
                                <div class="slider-container">
                                    <input type="range" id="steering-wheel-height" min="0" max="100" value="50">
                                    <span id="steering-wheel-height-value">50%</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">方向盘伸缩</div>
                                    <div class="setting-description">调整方向盘伸缩距离</div>
                                </div>
                                <div class="slider-container">
                                    <input type="range" id="steering-wheel-telescope" min="0" max="100" value="50">
                                    <span id="steering-wheel-telescope-value">50%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 空调设置 -->
                    <div class="settings-section">
                        <h4><i class="fas fa-snowflake"></i> 空调设置</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶侧温度</div>
                                    <div class="setting-description">调整驾驶侧空调温度</div>
                                </div>
                                <div class="temp-control">
                                    <button class="temp-btn" onclick="adjustTemp('driver', -0.5)">-</button>
                                    <span id="driver-temp-display">22.0°C</span>
                                    <button class="temp-btn" onclick="adjustTemp('driver', 0.5)">+</button>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">副驾驶侧温度</div>
                                    <div class="setting-description">调整副驾驶侧空调温度</div>
                                </div>
                                <div class="temp-control">
                                    <button class="temp-btn" onclick="adjustTemp('passenger', -0.5)">-</button>
                                    <span id="passenger-temp-display">22.0°C</span>
                                    <button class="temp-btn" onclick="adjustTemp('passenger', 0.5)">+</button>
                                </div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">风速</div>
                                    <div class="setting-description">调整空调风速</div>
                                </div>
                                <select id="ac-fan-speed" class="setting-select">
                                    <option value="1">1档</option>
                                    <option value="2">2档</option>
                                    <option value="3">3档</option>
                                    <option value="4">4档</option>
                                    <option value="5">5档</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">空调模式</div>
                                    <div class="setting-description">选择空调运行模式</div>
                                </div>
                                <select id="ac-mode" class="setting-select">
                                    <option value="auto">自动</option>
                                    <option value="manual">手动</option>
                                    <option value="eco">节能</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 驾驶模式设置 -->
                    <div class="settings-section">
                        <h4><i class="fas fa-road"></i> 驾驶模式</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">驾驶模式</div>
                                    <div class="setting-description">选择车辆驾驶模式</div>
                                </div>
                                <select id="drive-mode" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="eco">节能</option>
                                    <option value="snow">雪地</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">悬挂模式</div>
                                    <div class="setting-description">调整悬挂系统</div>
                                </div>
                                <select id="suspension-mode" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="comfort">舒适</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">转向模式</div>
                                    <div class="setting-description">调整转向系统</div>
                                </div>
                                <select id="steering-mode" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="comfort">舒适</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">制动模式</div>
                                    <div class="setting-description">调整制动系统</div>
                                </div>
                                <select id="brake-mode" class="setting-select">
                                    <option value="normal">标准</option>
                                    <option value="sport">运动</option>
                                    <option value="comfort">舒适</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 通知设置 -->
                <div id="notification-settings" class="settings-panel">
                    <h3>通知设置</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">系统通知</div>
                            <div class="setting-description">接收系统更新和维护通知</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="system-notifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">安全提醒</div>
                            <div class="setting-description">接收安全相关的提醒和警告</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="security-alerts" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">驾驶建议</div>
                            <div class="setting-description">接收智能驾驶建议和路况提醒</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="driving-suggestions">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">营销信息</div>
                            <div class="setting-description">接收产品更新和优惠信息</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="marketing-info">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- 隐私安全设置 -->
                <div id="privacy-settings" class="settings-panel">
                    <h3>隐私安全</h3>
                    <div class="info-card">
                        <h4><i class="fas fa-shield-alt"></i> 数据保护</h4>
                        <p>我们严格遵守数据保护法规，您的个人信息将被安全存储和传输。</p>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">位置信息</div>
                            <div class="setting-description">允许应用获取位置信息用于导航</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="location-permission" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">语音识别</div>
                            <div class="setting-description">允许语音命令识别功能</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="voice-recognition" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">驾驶数据</div>
                        </div>
                        <button class="btn-secondary">导出数据</button>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">删除账户</div>
                        </div>
                        <button class="btn-secondary" style="background: #e74c3c;">删除</button>
                    </div>
                </div>

                <!-- 系统设置 -->
                <div id="system-settings" class="settings-panel">
                    <h3>系统设置</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">主题模式</div>
                            <div class="setting-description">选择深色或浅色主题</div>
                        </div>
                        <select id="theme-select" class="setting-select">
                            <option value="dark">深色主题</option>
                            <option value="light">浅色主题</option>
                            <option value="auto">跟随系统</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">语言设置</div>
                            <div class="setting-description">选择系统显示语言</div>
                        </div>
                        <select id="language-select" class="setting-select">
                            <option value="zh-CN">简体中文</option>
                            <option value="en-US">English</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">音量设置</div>
                            <div class="setting-description">调整系统默认音量</div>
                        </div>
                        <div class="volume-slider">
                            <input type="range" id="volume-slider" min="0" max="100" value="70">
                            <span id="volume-value">70%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">自动锁屏</div>
                            <div class="setting-description">设置自动锁屏时间</div>
                        </div>
                        <select id="auto-lock-select" class="setting-select">
                            <option value="never">永不</option>
                            <option value="1">1分钟</option>
                            <option value="5">5分钟</option>
                            <option value="15">15分钟</option>
                            <option value="30">30分钟</option>
                        </select>
                    </div>
                </div>

                <!-- 关于系统 -->
                <div id="about-settings" class="settings-panel">
                    <h3>关于系统</h3>
                    <div class="info-card">
                        <h4><i class="fas fa-car"></i> 智能驾驶系统</h4>
                        <p>版本：v1.0.0</p>
                        <p>构建日期：2024年12月</p>
                    </div>
                    <div class="info-card">
                        <h4><i class="fas fa-code"></i> 技术特性</h4>
                        <p>• 智能语音控制</p>
                        <p>• 实时导航系统</p>
                        <p>• 多媒体娱乐</p>
                        <p>• 环境监测</p>
                        <p>• 安全防护</p>
                    </div>
                    <div class="info-card">
                        <h4><i class="fas fa-heart"></i> 联系我们</h4>
                        <p>邮箱：support@drivingsystem.com</p>
                        <p>电话：400-888-8888</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ============================= Apps Module (NEW) ========================= -->
    <!-- ======================================================================= -->
    <div id="apps-module" class="module">
        <div class="module-header">
            <h2>车载应用</h2>
            <button class="close-module-btn" data-target="app-drawer"><i class="fas fa-arrow-left"></i></button>
        </div>
        <div class="module-content">
            <div class="apps-grid">
                <!-- Future apps will go here -->
                <p style="color: #6e7681;">更多应用正在开发中...</p>
            </div>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- ========================= Fatigue Monitor Module (NEW) ================ -->
    <!-- ======================================================================= -->
    <div id="fatigue-module" class="module">
        <div class="module-header">
            <h2>疲劳监测</h2>
            <button class="close-module-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="module-content" style="justify-content: center; align-items: center; text-align: center; color: #6e7681;">
            <i class="fas fa-bed" style="font-size: 8rem; margin-bottom: 20px;"></i>
            <h3>疲劳监测功能正在开发中</h3>
        </div>
    </div>

    </div>

    <!-- Amap JS API Loader -->
    <script type="text/javascript" src="https://webapi.amap.com/loader.js"></script>
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <!-- Main App Logic -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
</body>
</html>